# ระบบ Gallery - คู่มือการใช้งาน

## ภาพรวม
ระบบ Gallery เป็นฟีเจอร์ที่อนุญาตให้ผู้ใช้ที่เข้าสู่ระบบแล้วสามารถอัปโหลดภาพพร้อมคำบรรยายเพื่อแสดงในแกลเลอรี่ได้

## เงื่อนไขการใช้งาน

### ✅ ผู้ใช้ที่เข้าสู่ระบบแล้ว
- สามารถอัปโหลดภาพได้ทันที
- ไม่มีข้อจำกัดเพิ่มเติม
- ภาพจะปรากฏในแกลเลอรี่ทันทีหลังอัปโหลดสำเร็จ
- สามารถเข้าถึงหน้า upload ได้โดยตรง

### ❌ ผู้ใช้ที่ไม่ได้เข้าสู่ระบบ
- จะถูก redirect ไปหน้า login พร้อมข้อความแจ้งเตือน
- ต้องเข้าสู่ระบบก่อนจึงจะสามารถอัปโหลดภาพได้
- หลัง login สำเร็จจะถูก redirect กลับมาหน้า upload อัตโนมัติ

## วิธีการใช้งาน

### 1. การเข้าสู่ระบบ
1. ไปที่หน้า `/login`
2. กรอกข้อมูล username และ password
3. คลิก "เข้าสู่ระบบ"

### 2. การอัปโหลดภาพ
1. ไปที่หน้า `/gallery`
2. คลิกปุ่ม "อัปโหลดภาพ" (สีส้ม) หรือ "เข้าสู่ระบบ" (สีเขียว)
3. หรือไปที่หน้า `/gallery/upload` โดยตรง
4. หากยังไม่ได้ login จะถูก redirect ไปหน้า login
5. หลัง login สำเร็จจะกลับมาหน้า upload อัตโนมัติ
6. เลือกภาพที่ต้องการอัปโหลด
7. กรอกชื่อภาพและคำบรรยาย
8. คลิก "อัปโหลดภาพ"

### 3. การดูภาพในแกลเลอรี่
1. ไปที่หน้า `/gallery`
2. ใช้ปุ่มลูกศรซ้าย-ขวาเพื่อเลื่อนดูภาพ
3. คลิกที่ thumbnail ด้านล่างเพื่อเลือกภาพ
4. คลิกปุ่ม fullscreen เพื่อดูภาพเต็มหน้าจอ

## ข้อกำหนดของไฟล์

### รูปภาพ
- **ประเภทไฟล์**: JPG, PNG, GIF
- **ขนาดไฟล์**: ไม่เกิน 10MB
- **ความละเอียด**: ไม่จำกัด

### ข้อมูลภาพ
- **ชื่อภาพ**: 1-100 ตัวอักษร
- **คำบรรยาย**: 1-500 ตัวอักษร

## โครงสร้างไฟล์

```
public/
├── uploads/
│   └── gallery/          # ไฟล์ภาพที่อัปโหลด
└── ...

data/
└── gallery.json         # ข้อมูลภาพในแกลเลอรี่

src/app/
├── api/
│   ├── gallery/
│   │   └── route.js     # API สำหรับจัดการภาพ
│   └── auth/
│       └── check/
│           └── route.js # API ตรวจสอบสถานะ login
├── gallery/
│   ├── page.jsx         # หน้าแกลเลอรี่
│   └── upload/
│       └── page.jsx     # หน้าอัปโหลดภาพ
```

## API Endpoints

### GET /api/gallery
- ดึงข้อมูลภาพทั้งหมดในแกลเลอรี่
- ไม่ต้อง login

### POST /api/gallery
- อัปโหลดภาพใหม่
- ต้อง login ก่อน

### GET /api/auth/check
- ตรวจสอบสถานะการเข้าสู่ระบบ
- ใช้สำหรับตรวจสอบ session token

## การจัดการข้อมูล

### การบันทึกไฟล์
- ไฟล์ภาพจะถูกบันทึกใน `public/uploads/gallery/`
- ชื่อไฟล์จะถูกสร้างแบบสุ่มเพื่อป้องกันการซ้ำ

### การบันทึกข้อมูล
- ข้อมูลภาพจะถูกบันทึกใน `data/gallery.json`
- ประกอบด้วย: id, src, alt, title, description, uploadedAt

## การรักษาความปลอดภัย

### การตรวจสอบ Authentication
- ทุกการอัปโหลดภาพจะตรวจสอบ session token
- ถ้า session หมดอายุจะแจ้งให้ login ใหม่
- ระบบจะ redirect ผู้ใช้ที่ไม่ได้ login ไปหน้า login อัตโนมัติ

### การตรวจสอบไฟล์
- ตรวจสอบประเภทไฟล์ (เฉพาะรูปภาพ)
- ตรวจสอบขนาดไฟล์ (ไม่เกิน 10MB)
- สร้างชื่อไฟล์ที่ไม่ซ้ำกัน

### การจัดการ Session
- ใช้ session token ในการตรวจสอบสถานะ login
- รองรับ redirect หลัง login สำเร็จ
- แสดงข้อความแจ้งเตือนที่เหมาะสม

## การแก้ไขปัญหา

### ปัญหาที่พบบ่อย

1. **ไม่สามารถอัปโหลดภาพได้**
   - ตรวจสอบว่าได้ login แล้ว
   - ตรวจสอบขนาดและประเภทไฟล์
   - ตรวจสอบว่า token ยังไม่หมดอายุ

2. **ภาพไม่ปรากฏในแกลเลอรี่**
   - รอสักครู่แล้ว refresh หน้า
   - ตรวจสอบว่าไฟล์ถูกบันทึกในโฟลเดอร์ที่ถูกต้อง

3. **Session หมดอายุ**
   - Login ใหม่
   - ตรวจสอบว่า browser อนุญาต cookies

4. **ระบบบังคับให้ login ซ้ำ**
   - ตรวจสอบว่าใช้ token cookie ที่ถูกต้อง
   - ล้าง cache และ cookies แล้วลองใหม่
   - ตรวจสอบว่า JWT_SECRET ถูกตั้งค่าไว้

### การแก้ไขปัญหา Token

หากพบปัญหาเกี่ยวกับ token ให้ทำตามขั้นตอนนี้:

1. **ล้าง cookies และ cache**
2. **Login ใหม่**
3. **ตรวจสอบว่า token ถูกบันทึกใน cookies**
4. **ตรวจสอบ JWT_SECRET ใน environment variables**

## การพัฒนาเพิ่มเติม

### ฟีเจอร์ที่อาจเพิ่มในอนาคต
- การลบภาพ
- การแก้ไขข้อมูลภาพ
- การจัดหมวดหมู่ภาพ
- การค้นหาภาพ
- การแชร์ภาพ
- การแสดงผู้อัปโหลด
- การแสดงวันที่อัปโหลด

### การปรับปรุงประสิทธิภาพ
- การบีบอัดภาพอัตโนมัติ
- การสร้าง thumbnail
- การใช้ CDN สำหรับไฟล์ภาพ
- การใช้ฐานข้อมูลแทนไฟล์ JSON
